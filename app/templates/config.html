{% extends "base.html" %}

{% block title %}Configuration - Yeastar Manager{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4"><i class="bi bi-gear-fill"></i> Configuration du système</h1>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-sliders"></i> Paramètres API Yeastar</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('config.update') }}">
                    <div class="mb-3">
                        <label for="pbx_url" class="form-label">URL du PBX Yeastar</label>
                        <input type="url" class="form-control" id="pbx_url" name="pbx_url"
                               value="{{ config.pbx_url if config else '' }}"
                               placeholder="https://your-pbx.com" required>
                        <div class="form-text">L'URL complète de votre PBX Yeastar (avec https://)</div>
                    </div>

                    <div class="mb-3">
                        <label for="client_id" class="form-label">Client ID</label>
                        <input type="text" class="form-control" id="client_id" name="client_id"
                               value="{{ config.client_id if config else '' }}" required>
                        <div class="form-text">Identifiant de l'application API</div>
                    </div>

                    <div class="mb-3">
                        <label for="client_secret" class="form-label">Client Secret</label>
                        <input type="password" class="form-control" id="client_secret" name="client_secret"
                               placeholder="{% if config and config.client_secret_encrypted %}••••••••{% else %}Entrez le client secret{% endif %}">
                        <div class="form-text">
                            {% if config and config.client_secret_encrypted %}
                            Le secret est déjà configuré. Laissez vide pour ne pas le modifier.
                            {% else %}
                            Secret de l'application API (sera chiffré en base de données)
                            {% endif %}
                        </div>
                    </div>

                    <hr class="my-4">

                    <div class="mb-3">
                        <label for="sync_interval_minutes" class="form-label">Intervalle de synchronisation (minutes)</label>
                        <input type="number" class="form-control" id="sync_interval_minutes" name="sync_interval_minutes"
                               value="{{ config.sync_interval_minutes if config else 5 }}" min="1" max="60" required>
                        <div class="form-text">Fréquence de vérification des plannings et mise à jour des statuts</div>
                    </div>

                    <div class="mb-3">
                        <label for="default_unavailable_status" class="form-label">Statut par défaut</label>
                        <select class="form-select" id="default_unavailable_status" name="default_unavailable_status">
                            <option value="available" {% if config and config.default_unavailable_status == 'available' %}selected{% endif %}>Available (Disponible)</option>
                            <option value="away" {% if config and config.default_unavailable_status == 'away' %}selected{% endif %}>Away (Absent)</option>
                            <option value="do_not_disturb" {% if config and config.default_unavailable_status == 'do_not_disturb' %}selected{% endif %}>Do Not Disturb (Ne pas déranger)</option>
                            <option value="busy" {% if config and config.default_unavailable_status == 'busy' %}selected{% endif %}>Busy (Occupé)</option>
                        </select>
                        <div class="form-text">Statut appliqué aux extensions en dehors des horaires de planning</div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('dashboard.index') }}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Annuler
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-lg"></i> Enregistrer
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0"><i class="bi bi-info-circle"></i> Aide</h6>
            </div>
            <div class="card-body">
                <h6>Configuration API</h6>
                <p class="small">Pour obtenir vos identifiants API Yeastar :</p>
                <ol class="small">
                    <li>Connectez-vous à votre PBX Yeastar</li>
                    <li>Allez dans <strong>Settings > API</strong></li>
                    <li>Créez une nouvelle application API</li>
                    <li>Copiez le Client ID et Client Secret</li>
                </ol>

                <hr>

                <h6>Intervalles de synchronisation</h6>
                <p class="small">
                    Une valeur trop basse (1-2 min) augmente la charge serveur.
                    Une valeur recommandée est de 5 minutes.
                </p>

                <hr>

                <h6>Statuts disponibles</h6>
                <ul class="small">
                    <li><strong>Available:</strong> Extension disponible</li>
                    <li><strong>Away:</strong> Extension absente</li>
                    <li><strong>Busy:</strong> Extension occupée</li>
                    <li><strong>Do Not Disturb:</strong> Ne pas déranger</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
